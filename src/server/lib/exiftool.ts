const { exiftool } = require("exiftool-vendored");

export const getVideoMetadata = (filePath: string) => {
  return new Promise<any>(async (res, rej) => {
    try {
      const metadata = await exiftool.read(filePath);
      res(metadata);
    } catch (error) {
      console.error("Error reading metadata:", error);
      res(undefined);
    } finally {
      // Make sure to close the ExifTool process
      await exiftool.end();
      console.log("Successfully closed exiftool.");
    }
  });
};

const example = {
  SourceFile: "/Users/hoiekim/Pictures/backup_videos_2/IMG_7367.MOV",
  errors: [],
  tz: "America/Los_Angeles",
  tzSource: "GPSLatitude/GPSLongitude",
  Duration: 11.7333333333333,
  PreviewDuration: 0,
  SelectionDuration: 0,
  TrackDuration: 11.7333333333333,
  MediaDuration: 11.7333333333333,
  GPSAltitude: 33.612,
  ExifToolVersion: 13,
  FileName: "IMG_7367.MOV",
  Directory: "/Users/hoiekim/Pictures/backup_videos_2",
  FileSize: "24 MB",
  FileModifyDate: {
    year: 2024,
    month: 11,
    day: 20,
    hour: 19,
    minute: 12,
    second: 52,
    millisecond: undefined,
    tzoffsetMinutes: -480,
    rawValue: "2024:11:20 19:12:52-08:00",
    zoneName: "UTC-8",
    inferredZone: false,
    zone: "UTC-8",
  },
  FileAccessDate: {
    year: 2024,
    month: 11,
    day: 20,
    hour: 20,
    minute: 18,
    second: 3,
    millisecond: undefined,
    tzoffsetMinutes: -480,
    rawValue: "2024:11:20 20:18:03-08:00",
    zoneName: "UTC-8",
    inferredZone: false,
    zone: "UTC-8",
  },
  FileInodeChangeDate: {
    year: 2024,
    month: 11,
    day: 20,
    hour: 20,
    minute: 18,
    second: 5,
    millisecond: undefined,
    tzoffsetMinutes: -480,
    rawValue: "2024:11:20 20:18:05-08:00",
    zoneName: "UTC-8",
    inferredZone: false,
    zone: "UTC-8",
  },
  FilePermissions: "-rw-------",
  FileType: "MOV",
  FileTypeExtension: "mov",
  MIMEType: "video/quicktime",
  MajorBrand: "Apple QuickTime (.MOV/QT)",
  MinorVersion: "0.0.0",
  CompatibleBrands: ["qt  "],
  MediaDataSize: 23751667,
  MediaDataOffset: 36,
  MovieHeaderVersion: 0,
  CreateDate: {
    year: 2022,
    month: 9,
    day: 5,
    hour: 12,
    minute: 11,
    second: 27,
    millisecond: undefined,
    tzoffsetMinutes: -420,
    rawValue: "2022:09:05 19:11:27",
    zoneName: "America/Los_Angeles",
    inferredZone: true,
    zone: "America/Los_Angeles",
  },
  ModifyDate: {
    year: 2022,
    month: 9,
    day: 5,
    hour: 12,
    minute: 11,
    second: 39,
    millisecond: undefined,
    tzoffsetMinutes: -420,
    rawValue: "2022:09:05 19:11:39",
    zoneName: "America/Los_Angeles",
    inferredZone: true,
    zone: "America/Los_Angeles",
  },
  TimeScale: 600,
  PreferredRate: 1,
  PreferredVolume: "100.00%",
  PreviewTime: "0 s",
  PosterTime: "0 s",
  SelectionTime: "0 s",
  CurrentTime: "0 s",
  NextTrackID: 5,
  TrackHeaderVersion: 0,
  TrackCreateDate: {
    year: 2022,
    month: 9,
    day: 5,
    hour: 12,
    minute: 11,
    second: 27,
    millisecond: undefined,
    tzoffsetMinutes: -420,
    rawValue: "2022:09:05 19:11:27",
    zoneName: "America/Los_Angeles",
    inferredZone: true,
    zone: "America/Los_Angeles",
  },
  TrackModifyDate: {
    year: 2022,
    month: 9,
    day: 5,
    hour: 12,
    minute: 11,
    second: 39,
    millisecond: undefined,
    tzoffsetMinutes: -420,
    rawValue: "2022:09:05 19:11:39",
    zoneName: "America/Los_Angeles",
    inferredZone: true,
    zone: "America/Los_Angeles",
  },
  TrackID: 1,
  TrackLayer: 0,
  TrackVolume: "0.00%",
  ImageWidth: 1920,
  ImageHeight: 1440,
  CleanApertureDimensions: "1920x1440",
  ProductionApertureDimensions: "1920x1440",
  EncodedPixelsDimensions: "1920x1440",
  GraphicsMode: "ditherCopy",
  OpColor: "32768 32768 32768",
  CompressorID: "hvc1",
  SourceImageWidth: 1920,
  SourceImageHeight: 1440,
  XResolution: 72,
  YResolution: 72,
  CompressorName: "HEVC",
  BitDepth: 24,
  VideoFrameRate: 30,
  Balance: 0,
  AudioFormat: "lpcm",
  AudioChannels: 3,
  AudioBitsPerSample: 16,
  AudioSampleRate: 1,
  MatrixStructure: "1 0 0 0 1 0 0 0 1",
  ContentDescribes: "Track 1",
  MediaHeaderVersion: 0,
  MediaCreateDate: {
    year: 2022,
    month: 9,
    day: 5,
    hour: 12,
    minute: 11,
    second: 27,
    millisecond: undefined,
    tzoffsetMinutes: -420,
    rawValue: "2022:09:05 19:11:27",
    zoneName: "America/Los_Angeles",
    inferredZone: true,
    zone: "America/Los_Angeles",
  },
  MediaModifyDate: {
    year: 2022,
    month: 9,
    day: 5,
    hour: 12,
    minute: 11,
    second: 39,
    millisecond: undefined,
    tzoffsetMinutes: -420,
    rawValue: "2022:09:05 19:11:39",
    zoneName: "America/Los_Angeles",
    inferredZone: true,
    zone: "America/Los_Angeles",
  },
  MediaTimeScale: 600,
  MediaLanguageCode: "und",
  GenMediaVersion: 0,
  GenFlags: "0 0 0",
  GenGraphicsMode: "ditherCopy",
  GenOpColor: "32768 32768 32768",
  GenBalance: 0,
  HandlerClass: "Data Handler",
  HandlerVendorID: "Apple",
  HandlerDescription: "Core Media Data Handler",
  MetaFormat: "mebx",
  HandlerType: "Metadata Tags",
  LocationAccuracyHorizontal: 15.617088,
  GPSCoordinates: `37 deg 20' 57.84" N, 121 deg 53' 29.04" W, 33.612 m Above Sea Level`,
  Make: "Apple",
  Model: "iPhone 13 mini",
  Software: "15.6.1",
  CreationDate: {
    year: 2022,
    month: 9,
    day: 5,
    hour: 12,
    minute: 11,
    second: 26,
    millisecond: undefined,
    tzoffsetMinutes: -420,
    rawValue: "2022:09:05 12:11:26-07:00",
    zoneName: "UTC-7",
    inferredZone: false,
    zone: "UTC-7",
  },
  ImageSize: "1920x1440",
  Megapixels: 2.8,
  AvgBitrate: "16.2 Mbps",
  GPSAltitudeRef: "Above Sea Level",
  GPSLatitude: 37.3494,
  GPSLongitude: -121.8914,
  Rotation: 90,
  GPSPosition: `37 deg 20' 57.84" N, 121 deg 53' 29.04" W`,
  warnings: [],
};
